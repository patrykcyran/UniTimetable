<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragment/general.html :: headerFragment" th:remove="tag"></div>
    <title>Lecturers</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/webjars/fullcalendar/2.2.5/fullcalendar.css">
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/webjars/fullcalendar/2.2.5/fullcalendar.print.css" media="print">

    <script src="http://cdn.jsdelivr.net/webjars/fullcalendar/2.2.5/fullcalendar.min.js"
            th:src="@{/webjars/fullcalendar/2.2.5/fullcalendar.min.js}"
            type="text/javascript"></script>
</head>
<body>
<div th:replace="fragment/general.html :: navigation-bar" id="navigation"></div>
<div class="container">

    <div class="d-flex justify-content-center text-center">
        <form method="get" th:action="@{/lecturers}" action="#">
            <select id="lecturerName" class="selectpicker" data-live-search="true" th:value="${LecturersNames}" name="lecturerName"
                    onchange='if(this.value !== 0) {this.form.submit(); }'>
                <option th:each="lecturer: ${LecturersNames}" th:value="${lecturer}" th:text="${lecturer}" th:selected="${lecturer} == ${prevLecturer}">SELECT</option>
            </select>
        </form>
    </div>

    <div id="user-info">
        <h1><b>Kalendarz Wizyt</b></h1>
        <div id='calendar'></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="http://cdn.jsdelivr.net/webjars/momentjs/2.9.0/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/webjars/fullcalendar/2.2.5/fullcalendar.min.js"></script>
</div>
<script>
    $(function () {

        function displayinfo(event, elements) {
            var name = event.title;
            console.log(name);
            var appointmentStart = moment(event.start).format("YYYY-MM-DD HH:mm:ss")
            alert(name + "  " + appointmentStart)
        }

        let lecturerName = '[[${prevLecturer}]]'; // Initial value
        const lecturerSelect = $('#lecturerName'); // Select picker element

        lecturerSelect.on('change', function () {
            patient_pesel = lecturerSelect.val(); // Update the patient_pesel variable with the selected value
            // Rest of your code...
        });

        $(document).ready(async function () {
            let url = '/semesterClasses/';
            if (lecturerName !== "") {
                url = '/semesterClasses/all/';
            }else
                lecturerName = 'all';
            url = url.concat(lecturerName);
            console.log(lecturerName);
            console.log(url);
            $('#calendar').fullCalendar({
                lang: 'pl',
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultView: 'agendaWeek',
                allDaySlot: false,
                slotDuration: '00:30:00', // Set the duration of each time slot (30 minutes in this example)
                minTime: '06:00:00', // Set the earliest time (midnight in this example)
                maxTime: '23:00:00',
                defaultDate: moment().format("YYYY-MM-DD"),
                editable: false,
                eventLimit: true,
                events: {
                    url: url,
                    method: 'GET',
                    success: function (data) {
                        console.log("Data: " + data);

                        // Parse the response and format it for FullCalendar
                        var events = data.map(function (event) {
                            return {
                                title: event.title,
                                start: moment(event.start), // Make sure the date format is valid
                                end: moment(event.end),     // Make sure the date format is valid
                            };
                        });

                        // Add the events to the calendar
                        $('#calendar').fullCalendar('addEventSource', events);
                    },
                    error: function () {
                        alert('There was an error while fetching events!');
                    }
                },
                selectable: true,
                selectHelper: true,
                loading: function (bool) {
                    $('#loading').toggle(bool);
                },
                eventClick: function (event, element) {
                    displayinfo(event, element);
                },
            });
        });
    });
</script>
</body>
</html>
